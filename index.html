<html>
    <head>
        <style type="text/css">
            #game {
                border: 1px solid black;
            }
        </style>
    </head>
    <body>
        <div id="game"></div>
        <script type="text/javascript" src="js/crafty.js"></script>
        <script>
            var viewWidth = 500,
                viewHeight = 350,
                charWidth = 50;

            Crafty.init(viewWidth, viewHeight, document.getElementById('game'));

            // left wall
            Crafty.e('2D, DOM, Solid, Color')
                .attr({x: 0, y: 0, w: 1, h: viewHeight})
                .color('#F00')

            // right wall
            Crafty.e('2D, DOM, Solid, Color')
                .attr({x: 499, y: 0, w: 1, h: viewHeight})
                .color('#F00')

            Crafty.c('Bullet', {
                init: function() {
                    this.requires('2D, DOM, Color, Collision, Motion')
                        .attr({w: 10, h: 10})
                        .color('#FF0000')
                    this.velocity().y = -150;
                }
            });



            Crafty.c('Enemy', {
                init: function() {
                    this.requires('2D, DOM, Color, Collision, Motion')
                        .attr({w: 20, h: 20})
                        .color('#000000')
                        .enemyWallHit()
                    this.velocity().x = -150
                },
                enemyWallHit: function() {
                    this.checkHits('Solid')
                        .bind('HitOn', function() {
                            var xVelEnemy = this.velocity().x
                            this.velocity().x = 0;
                            this.velocity().y = 50;
                            //debugger
                            var enemy = this;
                            setTimeout(function() {
                                enemy.velocity().y = 0;
                                enemy.velocity().x = -xVelEnemy
                                //debugger
                            }, 1000)

                        })
                }
            })


            // This is the player-controlled character
            Crafty.c('PlayerCharacter', {
                init: function() {
                    this.requires('2D, DOM, Color, Collision, Twoway')
                        .attr({w: charWidth, h: 50})
                        .color('#F00')
                        .twoway(300)
                        .stopOnSolids()
                        .shootOnSpace()
                },

                // Registers a stop-movement function to be called when
                //    this entity hits an entity with the "Solid" component
                stopOnSolids: function() {
                    this.onHit('Solid', this.stopMovement);
                    return this;
                },

                // Stops the movement
                stopMovement: function(hit_vals) {
                    this.x -= this.dx;
                },

                // shoot bullets
                shootOnSpace: function() {
                    var ship = this;
                    this.bind('KeyDown', function(e) {
                        if (e.key == Crafty.keys.SPACE) {
                            Crafty.e('Bullet').attr({
                                x: ship.x + charWidth / 2 - 5,
                                y: ship.y
                            })
                        }
                    });
                }
            });
            Crafty.e('PlayerCharacter').attr({x: (viewWidth - charWidth) / 2, y: viewHeight - 55 });
            Crafty.e('Enemy').attr({x: (viewWidth - 20) / 2, y: 30});
        </script>
    </body>
</html>
